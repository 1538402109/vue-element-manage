### 更换element的主题色

1.准备一个默认的颜色系列，此颜色系列是根据默认的基础色生成的。

​	比如默认基础色为"#409eff"，由此生成一个默认颜色系列为["409eff", "64,158,255", "53a8ff", "66b1ff", "79bbff", "8cc5ff", "a0cfff", "b3d8ff", "c6e2ff", "d9ecff", "ecf5ff", "3a8ee6"]

```js
// 由基础颜色值生成一系列颜色值
getColors(theme) {
  // 实现scss的mix函数，主题色与#fff进行混合。与白色混合其实就是改变透明度。
  // mix(#fff, #409eff, 90%); rgba(64,158,255,0.1); 它们的效果是一样的
  const tintColor = (color, tint) => {
    let red = parseInt(color.slice(0, 2), 16);
    let green = parseInt(color.slice(2, 4), 16);
    let blue = parseInt(color.slice(4, 6), 16);
    // 有些背景需要设置透明度，用到了rgba颜色值。
    if (tint === 0) {
      return [red, green, blue].join(',');
      //如果是未经压缩的css文件，或scss编译后的css文件，注意rgba中逗号后会有一个空格。
    } else {
      red = Math.round(red * (1 - tint) + 255 * tint);
      green = Math.round(green * (1 - tint) + 255 * tint);
      blue = Math.round(blue * (1 - tint) + 255 * tint);
      red = red.toString(16);
      green = green.toString(16);
      blue = blue.toString(16);
      return `${red}${green}${blue}`;
    }
  };
  // $button-active使用的这个色
  const shadeColor = (color, shade) => {
    let red = parseInt(color.slice(0, 2), 16);
    let green = parseInt(color.slice(2, 4), 16);
    let blue = parseInt(color.slice(4, 6), 16);
    red = Math.round((1 - shade) * red);
    green = Math.round((1 - shade) * green);
    blue = Math.round((1 - shade) * blue);
    red = red.toString(16);
    green = green.toString(16);
    blue = blue.toString(16);
    return `${red}${green}${blue}`;
  };
  const colors = [theme];
  for (let i = 0; i < 10; i++) {
    colors.push(tintColor(theme, i / 10));
  }
  colors.push(shadeColor(theme, 0.1));
  return colors;
},
```

2.获取element的默认样式

```js
// 获取element的默认样式
getDefaultStyle() {
  const version = require('element-ui/package.json').version;
  const url = `https://unpkg.com/element-ui@${version}/lib/theme-chalk/index.css`;
  const xhr = new XMLHttpRequest();
  xhr.onreadystatechange = () => {
    if (xhr.readyState === 4 && xhr.status === 200) {
      //字体文件还是用element的theme-chalk中的
      this.defaultStyle = xhr.responseText.replace(/@font-face{[^}]+}/, '');
      this.defaultColors = this.getColors('#409eff'.replace('#', ''));
      // 生成的颜色系列：["409eff", "64,158,255", "53a8ff", "66b1ff", "79bbff", "8cc5ff", "a0cfff", "b3d8ff", "c6e2ff", "d9ecff", "ecf5ff", "3a8ee6"]
      this.theme = this.$store.getters.theme;
    }
  };
  xhr.open('GET', url, true);
  xhr.send();
},
```

3.当用户在颜色选择器中选择完颜色后，以所选的这个颜色为基础色生成一个颜色系列。将默认颜色系列换成新生成的颜色系列,并替换掉之前动态创建的style元素的内容。

```javascript
// 更新element主题
updateElementTheme(newTheme) {
  const newColors = this.getColors(newTheme.replace('#', ''));
  let newStyle = this.defaultStyle;
  this.defaultColors.forEach((color, index) => {
    newStyle = newStyle.replace(new RegExp(color, 'ig'), newColors[index]);
  });
  document.head.querySelector('#element_theme').innerText = newStyle;
},
```

如果项目中使用的less，可以使用less的modifyVars来在线编译less。

###  更换自己书写的主题色

方式一：获取store中存储的主题色，使用内联样式绑定：

```vue
<template>
  <div :style="{'background-color':theme}"></div>
</template>

<script>
  export default {
    computed: {
      theme() {
        return this.$store.getters.theme
      }
    }
  }
</script>
```

   方式二：使用css变量：

```js
// 更新自己书写的css的主题
updateCustomTheme(newTheme) {
  const newColors = this.getColors(newTheme.replace('#', ''));
  const rootStyle = document.documentElement.style;
  newColors.forEach((color, index) => {
    if (index === 0) {
      rootStyle.setProperty('--theme', `#${color}`);
      return;
    }
    if (index === 11) {
      rootStyle.setProperty('--theme-shade', `#${color}`);
      return;
    }
    if (index >= 2) {
      rootStyle.setProperty(`--theme-white__${index -1}`, `#${color}`);
    }
  })
}
```

使用：

```vue
<style lang="scss" scoped>
  .header {
    background-color: var(--theme);
  }
</style>
```

html设置的css变量如下：

![u7nBuV.png](https://s2.ax1x.com/2019/10/10/u7nBuV.png)