(window.webpackJsonp=window.webpackJsonp||[]).push([[46],{685:function(e,t,n){},686:function(e,t,n){},687:function(e,t,n){},828:function(e,t,n){"use strict";var a=n(685);n.n(a).a},829:function(e,t,n){"use strict";var a=n(686);n.n(a).a},830:function(e,t,n){"use strict";var a=n(687);n.n(a).a},846:function(e,t,n){"use strict";n.r(t);var a=n(121),r=n.n(a),o=n(180),i=n.n(o),l=n(71),s=n(18),u=n(181),c=n(690),d=n(688),p=n(689),m=n(29),g=n.n(m),f={account:"",name:"",roles:[],gender:"",avatar:"",mobilePhone:"",email:""},b={props:{id:{type:String,default:""},visible:{type:Boolean,default:!1}},watch:{visible:function(e){e&&this.getDetail()}},data:function(){return{tableMng:u.a,userInfoBackup:g()({},f),userInfo:g()({},f),formRules:{account:[{required:!0,message:"请填写账号",trigger:"blur"},{pattern:/^[a-zA-Z0-9_]{5,10}$/,message:"账号为5到10位的字母、数字或下划线组成",trigger:"blur"}],name:[{required:!0,message:"请填写姓名",trigger:"blur"},{max:6,message:"姓名长度不能超过6个字",trigger:"blur"}],roles:[{required:!0,message:"请选择角色",trigger:"change"}],mobilePhone:[{required:!0,message:"请填写手机号",trigger:"blur"},{pattern:/^1[345789]\d{9}$/,message:"手机号码格式不正确",trigger:"blur"}],email:[{type:"email",message:"邮箱格式不正确",trigger:"blur"}]},uploading:!1,submitLoading:!1,getDetailLoading:!1}},methods:{getDetail:function(){var e=this;return i()(r.a.mark(function t(){var n;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.id){t.next=2;break}return t.abrupt("return");case 2:return e.getDetailLoading=!0,t.next=5,l.a.user.getDetail({id:e.id});case 5:n=t.sent,e.userInfo=g()({},n.data.detail),e.userInfoBackup=g()({},n.data.detail),e.getDetailLoading=!1;case 9:case"end":return t.stop()}},t,e)}))()},handleSubmit:function(){var e=this;this.submitLoading=!0,this.$refs.form.validate(function(t){t?l.a.user.save({detail:e.userInfo}).then(function(t){e.submitLoading=!1,e.handleClose(),e.$emit("onSave"),e.$message.success("提交成功")}):(e.submitLoading=!1,e.$message.error("请按照正确格式填写"))})},handleBeforeClose:function(){var e=this;window.JSON.stringify(this.userInfoBackup)===window.JSON.stringify(this.userInfo)?this.handleClose():this.$confirm("信息修改后未提交，确认关闭？","提示",{type:"warning"}).then(function(){e.handleClose()}).catch(function(){})},handleClose:function(){this.$refs.form.resetFields(),this.userInfo=f,this.userInfoBackup=f,this.$emit("onClose")},beforeUpload:function(e){this.uploading=!0,this.userInfo.avatar="";var t=/\.(jpg|png)$/.test(e.name),n=e.size/1024/1024<2;return t||(this.$message.error("上传头像图片只能是jpg或png格式!"),this.uploading=!1),n||(this.$message.error("上传头像图片大小不能超过 2MB!"),this.uploading=!1),t&&n},handleUploadSuccess:function(e,t){this.uploading=!1,this.userInfo.avatar=window.URL.createObjectURL(t.raw)}}},h=(n(828),n(829),n(70)),v=Object(h.a)(b,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{staticClass:"user-edit",attrs:{title:e.id?"编辑用户":"新增用户",width:"700px",visible:e.visible,"before-close":e.handleBeforeClose}},[n("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.getDetailLoading,expression:"getDetailLoading"}],ref:"form",attrs:{model:e.userInfo,rules:e.formRules,"label-width":"70px"}},[n("el-form-item",{attrs:{label:"账号:",prop:"account"}},[n("el-input",{attrs:{placeholder:"请填写账号",clearable:"",disabled:!!e.id},model:{value:e.userInfo.account,callback:function(t){e.$set(e.userInfo,"account",t)},expression:"userInfo.account"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"姓名:",prop:"name"}},[n("el-input",{attrs:{placeholder:"请填写用户姓名",clearable:""},model:{value:e.userInfo.name,callback:function(t){e.$set(e.userInfo,"name",t)},expression:"userInfo.name"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"角色:",prop:"roles"}},[n("el-select",{attrs:{multiple:"",placeholder:"请选择用户角色"},model:{value:e.userInfo.roles,callback:function(t){e.$set(e.userInfo,"roles",t)},expression:"userInfo.roles"}},e._l(e.tableMng.getTable("role"),function(e){return n("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)],1),e._v(" "),n("el-form-item",{attrs:{label:"性别:"}},[n("el-radio-group",{model:{value:e.userInfo.gender,callback:function(t){e.$set(e.userInfo,"gender",t)},expression:"userInfo.gender"}},e._l(e.tableMng.getTable("gender"),function(t){return n("el-radio",{key:t.id,attrs:{label:t.id}},[e._v(e._s(t.name))])}),1)],1),e._v(" "),n("el-form-item",{attrs:{label:"头像:"}},[n("el-upload",{staticClass:"avatar-uploader",style:{backgroundImage:"url("+(e.userInfo.avatar?e.userInfo.avatar:"")+")"},attrs:{action:"https://jsonplaceholder.typicode.com/posts/","show-file-list":!1,"before-upload":e.beforeUpload,"on-success":e.handleUploadSuccess}},[e.userInfo.avatar?e._e():n("i",{staticClass:"icon",class:e.uploading?"el-icon-loading":"el-icon-plus"})])],1),e._v(" "),n("el-row",[n("el-col",{attrs:{span:12}},[n("el-form-item",{attrs:{label:"手机:",placeholder:"请填写手机号",prop:"mobilePhone"}},[n("el-input",{attrs:{clearable:""},model:{value:e.userInfo.mobilePhone,callback:function(t){e.$set(e.userInfo,"mobilePhone",t)},expression:"userInfo.mobilePhone"}})],1)],1),e._v(" "),n("el-col",{attrs:{span:12}},[n("el-form-item",{attrs:{label:"邮箱:",placeholder:"请填写邮箱地址",prop:"email"}},[n("el-input",{attrs:{clearable:""},model:{value:e.userInfo.email,callback:function(t){e.$set(e.userInfo,"email",t)},expression:"userInfo.email"}})],1)],1)],1)],1),e._v(" "),n("span",{attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:e.handleClose}},[e._v("取 消")]),e._v(" "),n("el-button",{attrs:{type:"primary",loading:e.submitLoading},on:{click:e.handleSubmit}},[e._v("提 交")])],1)],1)},[],!1,null,"e1093e30",null).exports,_={name:"User",components:{SectionTitle:c.a,ExportExcel:d.a,Pagination:p.a,Edit:v},data:function(){return{tableMng:u.a,userList:[],tableLoading:!1,queryCondition:{name:"",gender:"",roles:[],pageNumber:1,pageSize:20},total:0,selectedRows:[],editId:"",editVisible:!1}},created:function(){this.getUserList()},methods:{getUserList:function(){var e=this;return i()(r.a.mark(function t(){var n,a;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.tableLoading=!0,t.next=3,l.a.user.getList(e.queryCondition);case 3:n=t.sent,e.userList=n.data.list.map(function(t,n){return{id:t.id,index:(e.queryCondition.pageNumber-1)*e.queryCondition.pageSize+n+1,name:t.name,mobilePhone:t.mobilePhone,gender:t.gender,roles:t.roles,registerDate:e.$dayjs(t.registerDate).format("YYYY-MM-DD HH:mm:ss"),consume:t.consume}}),e.total=n.data.total,e.tableLoading=!1,a=document.querySelector(".inner-layout__page"),Object(s.e)(a,0,800);case 9:case"end":return t.stop()}},t,e)}))()},handleEdit:function(e,t){this.editId=t?t.id:"",this.editVisible=!0},handleDelete:function(e,t){var n=this,a=[],o=[];t?(a=[t.id],o=[t.name]):(a=this.selectedRows.map(function(e){return e.id}),o=this.selectedRows.map(function(e){return e.name})),0===o.length?this.$message.warning("请选择要删除的用户！"):this.$confirm("确认删除用户“"+o.join("，")+"”？","提示",{type:"warning"}).then(i()(r.a.mark(function e(){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.a.user.remove({id:a});case 2:n.$message.success("删除成功！"),n.getUserList();case 4:case"end":return e.stop()}},e,n)}))).catch(function(){})},handleSelectedRows:function(e){this.selectedRows=e},handleSave:function(){this.handleClose(),this.getUserList()},handleClose:function(){this.editVisible=!1}}},y=(n(830),Object(h.a)(_,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"user-manager"},[n("div",{staticClass:"user-manager__header"},[n("section-title",{attrs:{name:"用户列表"}}),e._v(" "),n("div",[n("el-button",{attrs:{type:"primary",round:"",icon:"el-icon-plus"},on:{click:e.handleEdit}},[e._v("新增用户")]),e._v(" "),n("el-button",{attrs:{type:"danger",round:"",icon:"el-icon-minus"},on:{click:e.handleDelete}},[e._v("批量删除")]),e._v(" "),n("export-excel",{attrs:{"file-name":"用户数据表",header:["序号","姓名","手机","性别","角色","注册时间","累计消费额(元)"],"filter-filed":["index","name","mobilePhone","gender","role","registerDate","consume"],data:e.userList}},[e._v("\n        导出表格\n      ")])],1)],1),e._v(" "),n("div",{staticClass:"user-manager__search"},[n("el-form",{attrs:{inline:!0,model:e.queryCondition}},[n("el-form-item",{attrs:{label:"姓名:"}},[n("el-input",{attrs:{placeholder:"请输入用户姓名关键字",clearable:""},model:{value:e.queryCondition.name,callback:function(t){e.$set(e.queryCondition,"name",t)},expression:"queryCondition.name"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"性别:"}},[n("el-select",{attrs:{placeholder:"请选择性别",clearable:""},model:{value:e.queryCondition.gender,callback:function(t){e.$set(e.queryCondition,"gender",t)},expression:"queryCondition.gender"}},e._l(e.tableMng.getTable("gender"),function(e){return n("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)],1),e._v(" "),n("el-form-item",{attrs:{label:"角色:"}},[n("el-select",{attrs:{placeholder:"请选择角色",multiple:"",clearable:""},model:{value:e.queryCondition.roles,callback:function(t){e.$set(e.queryCondition,"roles",t)},expression:"queryCondition.roles"}},e._l(e.tableMng.getTable("role"),function(e){return n("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)],1),e._v(" "),n("el-form-item",[n("el-button",{attrs:{type:"primary",round:"",icon:"el-icon-search"},on:{click:e.getUserList}},[e._v("查询")])],1)],1)],1),e._v(" "),n("div",{staticClass:"user-manager__table"},[n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],attrs:{data:e.userList,border:"","highlight-current-row":""},on:{"selection-change":e.handleSelectedRows}},[n("el-table-column",{attrs:{type:"selection",width:"50px"}}),e._v(" "),n("el-table-column",{attrs:{prop:"index",label:"序号",width:"80px"}}),e._v(" "),n("el-table-column",{attrs:{prop:"name",label:"姓名"}}),e._v(" "),n("el-table-column",{attrs:{prop:"mobilePhone",label:"手机",width:"120px"}}),e._v(" "),n("el-table-column",{attrs:{prop:"gender",label:"性别",width:"120px"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",[e._v(e._s(e.tableMng.getNameById("gender",t.row.gender)))])]}}])}),e._v(" "),n("el-table-column",{attrs:{prop:"roles",label:"角色"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.roles,function(a,r){return n("span",{key:a},[e._v("\n            "+e._s(e.tableMng.getNameById("role",a))+"\n            "),t.row.roles.length!==r+1?n("span",[e._v(",")]):e._e()])})}}])}),e._v(" "),n("el-table-column",{attrs:{prop:"registerDate",label:"注册时间",sortable:""}}),e._v(" "),n("el-table-column",{attrs:{prop:"consume",label:"累计消费额(元)",width:"160px",sortable:""}}),e._v(" "),n("el-table-column",{attrs:{label:"操作",width:"120px"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{type:"text"},on:{click:function(n){return e.handleEdit(t.$index,t.row)}}},[e._v("编辑")]),e._v(" "),n("el-divider",{attrs:{direction:"vertical"}}),e._v(" "),n("el-button",{attrs:{type:"text"},on:{click:function(n){return e.handleDelete(t.$index,t.row)}}},[e._v("删除")])]}}])})],1)],1),e._v(" "),n("pagination",{attrs:{total:e.total,"page-number":e.queryCondition.pageNumber,"page-size":e.queryCondition.pageSize},on:{"update:pageNumber":function(t){return e.$set(e.queryCondition,"pageNumber",t)},"update:page-number":function(t){return e.$set(e.queryCondition,"pageNumber",t)},"update:pageSize":function(t){return e.$set(e.queryCondition,"pageSize",t)},"update:page-size":function(t){return e.$set(e.queryCondition,"pageSize",t)},pagination:e.getUserList}}),e._v(" "),n("edit",{attrs:{id:e.editId,visible:e.editVisible},on:{onClose:e.handleClose,onSave:e.handleSave}})],1)},[],!1,null,"05316674",null).exports);n.d(t,"default",function(){return y})}}]);