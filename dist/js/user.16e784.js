(window.webpackJsonp=window.webpackJsonp||[]).push([[40],{658:function(e,t,a){},659:function(e,t,a){},660:function(e,t,a){},774:function(e,t,a){e.exports={default:a(775),__esModule:!0}},775:function(e,t,a){a(776),e.exports=a(14).Object.keys},776:function(e,t,a){var n=a(94),r=a(77);a(777)("keys",function(){return function(e){return r(n(e))}})},777:function(e,t,a){var n=a(19),r=a(14),i=a(68);e.exports=function(e,t){var a=(r.Object||{})[e]||Object[e],l={};l[e]=t(a),n(n.S+n.F*i(function(){a(1)}),"Object",l)}},778:function(e,t,a){"use strict";var n=a(658);a.n(n).a},779:function(e,t,a){"use strict";var n=a(659);a.n(n).a},780:function(e,t,a){"use strict";var n=a(660);a.n(n).a},793:function(e,t,a){"use strict";a.r(t);var n=a(619),r=a.n(n),i=a(591),l=a.n(i),o=a(592),s=a.n(o),u=a(586),c=a(92),d=a(584),f=a(93),m=a(662),p=a(661),g=a(663),b=a(774),v=a.n(b),h=a(249),_=a.n(h),y={data:function(){return{isEdit:!1,userInfo:{account:"",name:"",role:"",gender:"",avatar:"",mobilePhone:"",email:""},userInfoReset:{},userInfoBackup:{},rules:{account:[{required:!0,message:"请填写账号",trigger:"blur"},{pattern:/^[a-zA-Z0-9_]{5,10}$/,message:"账号为5到10位的字母、数字或下划线组成",trigger:"blur"}],name:[{required:!0,message:"请填写姓名",trigger:"blur"},{max:6,message:"姓名长度不能超过6个字",trigger:"blur"}],role:[{required:!0,message:"请选择角色",trigger:"change"}],mobilePhone:[{pattern:/^1[345789]\d{9}$/,message:"手机号码格式不正确",trigger:"blur"}],email:[{type:"email",message:"邮箱格式不正确",trigger:"blur"}]},roleList:[{value:"管理员",label:"管理员"},{value:"编辑",label:"编辑"},{value:"普通会员",label:"普通会员"},{value:"高级会员",label:"高级会员"},{value:"普通用户",label:"普通用户"}],submitLoading:!1,getDetailLoading:!1,dialogVisible:!1,title:"编辑用户"}},created:function(){var e=this;d.a.$on("userDetail",function(t){_()(e.userInfoReset,e.userInfo),_()(e.userInfoBackup,e.userInfo),t?(e.isEdit=!0,e.title="编辑用户",e.getDetail(t)):(e.isEdit=!1,e.title="创建用户"),e.dialogVisible=!0})},methods:{getDetail:function(e){var t=this;this.getDetailLoading=!0,c.a.user.getDetail({id:e}).then(function(e){t.userInfo=e.data.userDetail,_()(t.userInfoBackup,t.userInfo),t.getDetailLoading=!1}).catch(function(e){t.getDetailLoading=!1})},beforeAvatarUpload:function(e){var t="image/jpeg"===e.type,a="image/png"===e.type,n=e.size/1024/1024<2;return t||a||this.$message.error("上传头像图片只能是jpg或png格式!"),n||this.$message.error("上传头像图片大小不能超过 2MB!"),(t||a)&&n},handleAvatarSuccess:function(e,t){this.userInfo.avatar=URL.createObjectURL(t.raw)},submit:function(){var e=this;this.submitLoading=!0,this.$refs.userInfo.validate(function(t){t?(e.$message.success("提交成功"),e.submitLoading=!1,e.isEdit?(e.dialogVisible=!1,e.resetForm()):e.resetForm()):e.submitLoading=!1})},handleClose:function(){var e=this,t=this.userInfo,a=this.userInfoBackup;v()(t).every(function(e){return t[e]===a[e]})?(this.dialogVisible=!1,this.resetForm()):this.$confirm("信息修改后未提交，确认关闭？","提示",{type:"warning"}).then(function(){e.dialogVisible=!1,e.resetForm()}).catch(function(){})},resetForm:function(){_()(this.userInfo,this.userInfoReset),this.$refs.userInfo.resetFields()}}},x=(a(778),a(779),a(67)),I=Object(x.a)(y,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:e.title,visible:e.dialogVisible,"before-close":e.handleClose,width:"700px"},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.getDetailLoading,expression:"getDetailLoading"}],ref:"userInfo",attrs:{model:e.userInfo,rules:e.rules,"label-width":"70px","label-position":"left"}},[a("el-form-item",{attrs:{label:"账号：",prop:"account"}},[a("el-input",{attrs:{placeholder:"请填写账号",clearable:"",disabled:e.isEdit},model:{value:e.userInfo.account,callback:function(t){e.$set(e.userInfo,"account",t)},expression:"userInfo.account"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"姓名：",prop:"name"}},[a("el-input",{attrs:{placeholder:"请填写用户姓名",clearable:""},model:{value:e.userInfo.name,callback:function(t){e.$set(e.userInfo,"name",t)},expression:"userInfo.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"角色：",prop:"role"}},[a("el-select",{attrs:{placeholder:"请选择用户角色"},model:{value:e.userInfo.role,callback:function(t){e.$set(e.userInfo,"role",t)},expression:"userInfo.role"}},e._l(e.roleList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"性别："}},[a("el-radio-group",{model:{value:e.userInfo.gender,callback:function(t){e.$set(e.userInfo,"gender",t)},expression:"userInfo.gender"}},[a("el-radio",{attrs:{label:"男"}}),e._v(" "),a("el-radio",{attrs:{label:"女"}})],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"头像："}},[a("el-upload",{staticClass:"avatar-uploader",attrs:{action:"https://jsonplaceholder.typicode.com/posts/","show-file-list":!1,"before-upload":e.beforeAvatarUpload,"on-success":e.handleAvatarSuccess}},[e.userInfo.avatar?a("img",{staticClass:"avatar",attrs:{src:e.userInfo.avatar}}):a("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1),e._v(" "),a("el-form-item",{attrs:{label:"手机：",placeholder:"请填写手机号",prop:"mobilePhone"}},[a("el-input",{attrs:{clearable:""},model:{value:e.userInfo.mobilePhone,callback:function(t){e.$set(e.userInfo,"mobilePhone",t)},expression:"userInfo.mobilePhone"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"邮箱：",placeholder:"请填写邮箱地址",prop:"email"}},[a("el-input",{attrs:{clearable:""},model:{value:e.userInfo.email,callback:function(t){e.$set(e.userInfo,"email",t)},expression:"userInfo.email"}})],1)],1),e._v(" "),a("span",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.handleClose}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.submit}},[e._v("提 交")])],1)],1)},[],!1,null,"5eb5b381",null).exports,C={components:{SectionTitle:m.a,ExportExcel:p.a,Pagination:g.a,UserDetail:I},data:function(){return{userList:[],excelHeader:["序号","姓名","年龄","性别","角色","注册时间","累计消费额(元)"],filterFiled:["index","name","age","gender","role","registerDate","consume"],genders:u.a.getTable("gender"),roles:u.a.getTable("role"),userTableLoading:!1,queryCondition:{name:"",gender:"",roles:[],pageNumber:1,pageSize:20},total:0,multipleSelection:[]}},created:function(){this.getUserList()},methods:{getUserList:function(){var e=this;return s()(l.a.mark(function t(){var a,n;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.userTableLoading=!0,t.next=3,c.a.user.getList(e.queryCondition);case 3:a=t.sent,e.userList=a.data.list.map(function(t,a){return{id:t.id,index:(e.queryCondition.pageNumber-1)*e.queryCondition.pageSize+a+1,name:t.name,age:t.age,gender:t.gender,role:t.role,registerDate:t.registerDate,consume:t.consume}}),e.total=a.data.total,e.userTableLoading=!1,n=document.querySelector(".inner-layout__page"),Object(f.c)(n,0,800);case 9:case"end":return t.stop()}},t,e)}))()},handleDeleteBatch:function(){var e=this;if(0===this.multipleSelection.length)this.$message.warning("请勾选要删除的用户！");else{var t=this.multipleSelection.map(function(e){return e.name});this.$confirm("确认删除用户“"+t.join("，")+"”？","提示",{type:"warning"}).then(function(){e.getUserList().then(function(t){e.$message.success("删除成功！")})}).catch(function(){})}},handleEdit:function(e,t){t||(t={}),d.a.$emit("userDetail",t.id)},handleDelete:function(e,t){var a=this;this.$confirm("确认删除用户“"+t.name+"”？","提示",{type:"warning"}).then(function(){a.getList(),a.$message.success("删除成功！")})},handleSelectionChange:function(e){this.multipleSelection=e},transmitData:function(){var e=this.tableHeader;return this.userList.map(function(t){delete t.id;var a=r()(t),n={};return e.forEach(function(t,r){n[e[r]]=a[r]}),n})}}},$=(a(780),Object(x.a)(C,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"user-manager"},[a("div",{staticClass:"user-manager__header"},[a("section-title",{attrs:{name:"用户列表"}}),e._v(" "),a("div",[a("el-button",{attrs:{type:"primary",round:"",icon:"el-icon-plus"},on:{click:e.handleEdit}},[e._v("新增用户")]),e._v(" "),a("el-button",{attrs:{type:"danger",round:"",icon:"el-icon-minus"},on:{click:e.handleDeleteBatch}},[e._v("批量删除")]),e._v(" "),a("export-excel",{attrs:{"file-name":"用户列表",header:e.excelHeader,"filter-filed":e.filterFiled,data:e.userList}},[e._v("导出表格")])],1)],1),e._v(" "),a("div",{staticClass:"user-manager__search"},[a("el-form",{attrs:{inline:!0,model:e.queryCondition}},[a("el-form-item",{attrs:{label:"姓名:"}},[a("el-input",{attrs:{placeholder:"请输入用户姓名关键字",clearable:""},model:{value:e.queryCondition.name,callback:function(t){e.$set(e.queryCondition,"name",t)},expression:"queryCondition.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"性别:"}},[a("el-select",{attrs:{placeholder:"请选择性别",clearable:""},model:{value:e.queryCondition.gender,callback:function(t){e.$set(e.queryCondition,"gender",t)},expression:"queryCondition.gender"}},e._l(e.genders,function(e){return a("el-option",{key:e.value,attrs:{label:e.name,value:e.id}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"角色:"}},[a("el-select",{attrs:{placeholder:"请选择角色",multiple:"",clearable:""},model:{value:e.queryCondition.roles,callback:function(t){e.$set(e.queryCondition,"roles",t)},expression:"queryCondition.roles"}},e._l(e.roles,function(e){return a("el-option",{key:e.value,attrs:{label:e.name,value:e.id}})}),1)],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary",round:"",icon:"el-icon-search"},on:{click:e.getUserList}},[e._v("查询")])],1)],1)],1),e._v(" "),a("div",{staticClass:"user-manager__table"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.userTableLoading,expression:"userTableLoading"}],attrs:{data:e.userList,border:"","highlight-current-row":""},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"50"}}),e._v(" "),a("el-table-column",{attrs:{prop:"index",label:"序号",width:"80px"}}),e._v(" "),a("el-table-column",{attrs:{prop:"name",label:"姓名"}}),e._v(" "),a("el-table-column",{attrs:{prop:"age",label:"年龄",width:"120px",sortable:""}}),e._v(" "),a("el-table-column",{attrs:{prop:"gender",label:"性别",width:"120px"}}),e._v(" "),a("el-table-column",{attrs:{prop:"role",label:"角色"}}),e._v(" "),a("el-table-column",{attrs:{prop:"registerDate",label:"注册时间",width:"120px",sortable:""}}),e._v(" "),a("el-table-column",{attrs:{prop:"consume",label:"累计消费额(元)",width:"160px",sortable:""}}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:"120px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.handleEdit(t.$index,t.row)}}},[e._v("编辑")]),e._v(" "),a("el-divider",{attrs:{direction:"vertical"}}),e._v(" "),a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.handleDelete(t.$index,t.row)}}},[e._v("删除")])]}}])})],1)],1),e._v(" "),a("pagination",{attrs:{total:e.total,"page-number":e.queryCondition.pageNumber,"page-size":e.queryCondition.pageSize},on:{"update:pageNumber":function(t){return e.$set(e.queryCondition,"pageNumber",t)},"update:page-number":function(t){return e.$set(e.queryCondition,"pageNumber",t)},"update:pageSize":function(t){return e.$set(e.queryCondition,"pageSize",t)},"update:page-size":function(t){return e.$set(e.queryCondition,"pageSize",t)},pagination:e.getUserList}}),e._v(" "),a("user-detail")],1)},[],!1,null,"7ce3cfbd",null).exports);a.d(t,"default",function(){return $})}}]);