(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{638:function(e,t,a){},639:function(e,t,a){},640:function(e,t,a){},772:function(e,t,a){"use strict";var i=a(638);a.n(i).a},773:function(e,t,a){"use strict";var i=a(639);a.n(i).a},774:function(e,t,a){"use strict";var i=a(640);a.n(i).a},863:function(e,t,a){"use strict";a.r(t);var i=a(123),n=a.n(i),l=a(182),r=a.n(l),s=a(42),o=a.n(s),c=a(74),u=a(709),d=a(183),m=a(704),p={props:{value:{type:Array,default:function(){return[]}},action:{required:!0,type:String,default:""},name:{type:String,default:"file"},sizeLimit:{type:Number,default:10},tip:{type:String,default:""}},data:function(){return{loading:!1}},methods:{beforeUpload:function(e){var t=e.size/1024/1024<this.sizeLimit;return t||this.$message.error("上传的文件小不能超过 "+this.sizeLimit+"MB!"),t&&(this.loading=!0),t},beforeRemove:function(e,t){return this.$confirm("确定删除“"+e.name+"”？")},handleSuccess:function(e,t,a){this.loading=!1,this.$emit("input",a)},handleRemove:function(e,t){this.$emit("input",t)},handlePreview:function(e){window.open(e.url)}}},f=(a(772),a(773),a(51)),h=Object(f.a)(p,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-upload",{staticClass:"drag-upload",attrs:{action:e.action,name:e.name,drag:"",multiple:"","file-list":e.value,"before-upload":e.beforeUpload,"before-remove":e.beforeRemove,"on-success":e.handleSuccess,"on-remove":e.handleRemove,"on-preview":e.handlePreview}},[a("i",{staticClass:"drag-upload__icon",class:e.loading?"el-icon-loading":"el-icon-upload "}),e._v(" "),a("p",{staticClass:"drag-upload__text"},[e._v("点击或直接将文件拖到此处上传")]),e._v(" "),a("p",{staticClass:"drag-upload__tip"},[e._v("文件大小不能超过"+e._s(e.sizeLimit)+"MB！"+e._s(e.tip))])])],1)},[],!1,null,"3634eae1",null).exports,g=a(703),b=a(15),v={props:{id:{type:String,default:function(){return"tinymce-"+ +new Date+(1e3*Math.random()).toFixed(0)}},value:{type:String,default:""},height:{type:Number,default:500}},data:function(){return{editorId:this.id,hasInit:!1,hasInput:!1}},watch:{value:function(e){!this.hasInput&&this.hasInit&&tinymce.get(this.editorId).insertContent(e)}},mounted:function(){this.init()},destroyed:function(){this.destoryTinymce()},activated:function(){this.init()},deactivated:function(){this.destoryTinymce()},methods:{init:function(){var e=this;Object(b.d)("https://cdn.jsdelivr.net/npm/tinymce@5.1.2/tinymce.min.js",function(t,a){t?e.$message.error(t.message):e.initTinymce()})},initTinymce:function(){var e=this;tinymce.init({selector:"#"+this.editorId,language:"zh_CN",language_url:"/static/tinymce/langs/zh_CN.js",height:this.height,plugins:"advlist autosave autolink charmap code codesample emoticons fullscreen help hr image insertdatetime link lists media pagebreak paste preview print searchreplace table textpattern visualblocks visualchars wordcount",toolbar:"restoredraft | undo redo | styleselect | bold italic underline forecolor backcolor removeformat | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | table link image media emoticons charmap | searchreplace fullscreen preview code print",contextmenu:"copy paste link inserttable ",auto_focus:this.editorId,paste_enable_default_filters:!1,insertdatetime_formats:["%Y-%m-%d %H:%M:%S","%Y/%m/%d %H:%M:%S","%Y年%m月%d日 %H点%M分%S秒","%Y年%m月%d日","%H点%M分"],table_toolbar:"tableprops tablerowprops tablecellprops | tableinsertcolbefore tableinsertcolafter tabledeletecol | tableinsertrowbefore tableinsertrowafter tabledeleterow | tablemergecells tablesplitcells | tabledelete",link_context_toolbar:!0,link_assume_external_targets:!0,setup:function(e){},init_instance_callback:function(t){e.hasInit=!0,e.value&&t.insertContent(e.value),t.on("setContent keyup ",function(){e.hasInput=!0,e.$emit("input",t.getContent())})},images_upload_handler:function(e,t,a){var i=e.blob(),n=e.base64(),l=i.type;"image/jpeg"===l?n="data:image/jpeg;base64,"+n:"image/png"===l?n="data:image/png;base64,"+n:"image/gif"===l&&(n="data:image/gif;base64,"+n);var r=new FormData;r.append("file",n),r.append("name",i.name),t(n)}})},destoryTinymce:function(){tinymce.get(this.editorId)&&tinymce.get(this.editorId).destroy()}}},y=Object(f.a)(v,function(){var e=this.$createElement;return(this._self._c||e)("textarea",{directives:[{name:"loading",rawName:"v-loading",value:!this.hasInit,expression:"!hasInit"}],attrs:{type:"textarea",id:this.editorId}})},[],!1,null,null,null).exports,_=a(219),D={id:"",name:"",type:"",content:"",createDate:a.n(_)()().format("YYYY-MM-DD HH:mm:ss"),imageURL:"",brief:"",accessory:[]},x={name:"ArticleEdit",props:["articleId"],components:{AvatarUpload:m.a,DragUpload:h,SectionTitle:g.a,Tinymce:y},data:function(){return{tableMng:d.a,articleDetail:o()({},D),formRules:{name:[{required:!0,message:"请填写文章标题",trigger:"blur"},{max:20,message:"标题不能超过20个字",trigger:"blur"}],type:[{required:!0,message:"请选择文章类型",trigger:"change"}],imageURL:[{required:!0,message:"请上传标题图片"}]},submitLoading:!1}},created:function(){this.getDetail()},methods:{getDetail:function(){var e=this;return r()(n.a.mark(function t(){var a,i;return n.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.articleId){t.next=8;break}return t.next=3,c.a.article.getDetail({id:e.articleId});case 3:a=t.sent,i=a.data,e.articleDetail={id:i.id,name:i.name,createDate:e.$dayjs(i.createDate).format("YYYY-MM-DD HH:mm:ss"),imageURL:i.imageURL,type:i.type,brief:i.brief,content:i.content,accessory:i.accessory},t.next=9;break;case 8:e.articleDetail=o()({},D);case 9:case"end":return t.stop()}},t,e)}))()},handleSubmit:function(){var e,t=this;this.$refs.form.validate((e=r()(n.a.mark(function e(a){return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!a){e.next=10;break}return t.submitLoading=!0,e.next=4,c.a.article.update({detail:t.articleDetail});case 4:e.sent,t.submitLoading=!1,t.$message.success("发布成功"),t.handleClose(),e.next=11;break;case 10:t.$message.error("请按照正确格式填写");case 11:case"end":return e.stop()}},e,t)})),function(t){return e.apply(this,arguments)}))},handleClose:function(){u.a.$emit("closeTag",this.$route.path),this.$router.push("/article/list")}}},w=(a(774),Object(f.a)(x,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"article-edit"},[a("div",{staticClass:"article-edit__header"},[a("div",{staticClass:"title"},[a("section-title",{attrs:{name:e.articleId?"编辑文章":"新增文章"}})],1),e._v(" "),a("div",{staticClass:"operation"},[a("el-button",{attrs:{type:"primary",icon:"el-icon-s-promotion",loading:e.submitLoading},on:{click:e.handleSubmit}},[e._v("发布")]),e._v(" "),a("el-button",{attrs:{type:"info",icon:"el-icon-circle-close"},on:{click:e.handleClose}},[e._v("取消")])],1)]),e._v(" "),a("el-row",[a("el-col",{attrs:{lg:16}},[a("tinymce",{attrs:{height:660},model:{value:e.articleDetail.content,callback:function(t){e.$set(e.articleDetail,"content",t)},expression:"articleDetail.content"}})],1),e._v(" "),a("el-col",{attrs:{lg:8}},[a("el-form",{ref:"form",staticClass:"article-edit__form",attrs:{model:e.articleDetail,rules:e.formRules,"label-width":"90px"}},[a("el-form-item",{attrs:{label:"文章标题:",prop:"name"}},[a("el-input",{attrs:{placeholder:"请输入文章标题",clearable:""},model:{value:e.articleDetail.name,callback:function(t){e.$set(e.articleDetail,"name",t)},expression:"articleDetail.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"文章类型:",prop:"type"}},[a("el-select",{attrs:{placeholder:"请选择文章类型",clearable:""},model:{value:e.articleDetail.type,callback:function(t){e.$set(e.articleDetail,"type",t)},expression:"articleDetail.type"}},e._l(e.tableMng.getTable("article"),function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"文章简介:"}},[a("el-input",{attrs:{type:"textarea",rows:3,maxlength:100,placeholder:"请输入文章简介",clearable:""},model:{value:e.articleDetail.brief,callback:function(t){e.$set(e.articleDetail,"brief",t)},expression:"articleDetail.brief"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"创建时间:",prop:"createDate"}},[a("el-input",{attrs:{disabled:""},model:{value:e.articleDetail.createDate,callback:function(t){e.$set(e.articleDetail,"createDate",t)},expression:"articleDetail.createDate"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"标题图片:",prop:"imageURL"}},[a("avatar-upload",{attrs:{action:"https://sm.ms/api/v2/upload",name:"smfile",round:!1,width:"80px"},model:{value:e.articleDetail.imageURL,callback:function(t){e.$set(e.articleDetail,"imageURL",t)},expression:"articleDetail.imageURL"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"附件上传:"}},[a("drag-upload",{attrs:{action:"https://jsonplaceholder.typicode.com/posts"},model:{value:e.articleDetail.accessory,callback:function(t){e.$set(e.articleDetail,"accessory",t)},expression:"articleDetail.accessory"}})],1)],1)],1)],1)],1)},[],!1,null,"7fc06b4a",null).exports);a.d(t,"default",function(){return w})}}]);